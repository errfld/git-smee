{"id":"git-smee-4q5","title":"Add explicit config validation with actionable error messages","description":"Background:\nThe config module defines `ValidationError` but currently does not run a dedicated validation pass after parse. Invalid-but-parseable configs can slip through until execution.\n\nWhy this matters:\n- Users get late/runtime failures instead of immediate feedback.\n- Errors do not always point to the exact hook entry causing problems.\n\nRelevant files:\n- `crates/git-smee-core/src/config.rs`\n- `crates/git-smee-cli/src/main.rs` (where config load errors are surfaced)\n\nImplementation notes:\n- Add a `validate()` pass on `SmeeConfig` and invoke it during load.\n- Validate at least:\n  - command string is not empty/whitespace\n  - hook table entries are structurally valid\n  - unexpected fields are rejected (`deny_unknown_fields` where appropriate)\n- Include hook name and entry index in validation errors for faster debugging.","acceptance_criteria":"1. Invalid configs fail during load with precise messages that identify the failing hook and command entry.\n2. Empty/whitespace `command` values are rejected before execution.\n3. Unknown fields in `HookDefinition` are rejected with clear feedback.\n4. Add unit tests for each validation rule and at least one valid config path.","status":"closed","priority":2,"issue_type":"task","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:19:44.392176+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-04T17:27:57.706649+01:00","closed_at":"2026-02-04T17:27:57.706649+01:00","close_reason":"Closed"}
{"id":"git-smee-5q6","title":"Make init/install safe for existing files (managed marker + --force)","description":"Background:\n`git smee init` and hook installation currently write files directly, which can overwrite existing user-managed `.git-smee.toml` or hook scripts.\n\nWhy this matters:\n- Risk of clobbering hand-written hook scripts.\n- Risk of destroying an existing config file unexpectedly.\n- Harder adoption in repositories with pre-existing hook workflows.\n\nRelevant files:\n- `crates/git-smee-cli/src/main.rs`\n- `crates/git-smee-core/src/installer.rs`\n- `crates/git-smee-core/src/scripts/hook_template_unix`\n- `crates/git-smee-core/src/scripts/hook_template_windows`\n- `README.md` command docs\n\nImplementation notes:\n- Detect whether an existing hook/config file is already managed by git-smee (using the managed header marker).\n- Default behavior should avoid overwriting unmanaged files.\n- Add `--force` to allow explicit overwrite.","acceptance_criteria":"1. `git smee init` refuses to overwrite an existing `.git-smee.toml` unless `--force` is provided.\n2. `git smee install` overwrites only managed hook files by default; unmanaged hooks are preserved with a clear message/error.\n3. With `--force`, both commands overwrite as requested.\n4. CLI help text and README document the default safety behavior and `--force`.\n5. Tests cover force and non-force paths.","status":"closed","priority":2,"issue_type":"feature","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:19:36.621231+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-04T17:27:08.281068+01:00","closed_at":"2026-02-04T17:27:08.281068+01:00","close_reason":"Closed"}
{"id":"git-smee-5tx","title":"Replace hard bash dependency in executor with portable shell","description":"Background:\nRuntime command execution on Unix currently spawns bash -c for every hook command, while generated hook wrappers use /usr/bin/env sh. The project README advertises lightweight cross-platform behavior, but requiring bash is stricter than required and can fail on environments that only provide POSIX sh (for example minimal containers).\n\nWhy this matters:\n- Hook execution can fail even though install succeeded.\n- Behavior differs between wrapper script shell and executor shell.\n- This is a portability bug for Unix-like systems without bash.\n\nRelevant files:\n- crates/git-smee-core/src/platform.rs\n- crates/git-smee-core/src/executor.rs\n- crates/git-smee-core/tests (add regression coverage)\n\nImplementation notes:\n- Use a more portable default shell for Unix command execution (for example sh -c), or add a robust fallback strategy.\n- Keep Windows behavior unchanged.\n- Ensure error messages make shell-launch failures actionable.","acceptance_criteria":"1. On Unix builds, executor no longer requires bash specifically to run hook commands.\n2. Add regression tests that verify chosen shell command construction and failure handling without assuming bash availability.\n3. Existing sequential/parallel hook behavior and exit-code propagation remain unchanged.\n4. Documentation or release notes mention the portability fix if user-visible.","notes":"2026-02-06 verification: confirmed unix runner now uses 'sh -c' in crates/git-smee-core/src/platform.rs, shell-aware spawn diagnostics are in crates/git-smee-core/src/executor.rs, and regression tests were added; fix is landed and issue remains closed.","status":"closed","priority":1,"issue_type":"bug","owner":"eran@riesenfeld.de","created_at":"2026-02-05T10:38:10.714914+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-06T11:47:51.462113+01:00","closed_at":"2026-02-06T11:00:19.839596+01:00","close_reason":"Closed"}
{"id":"git-smee-7ud","title":"Improve executor error modeling for spawn vs exit failures","description":"Background:\n`executor::Error` includes `NonSuccessfulExitStatus(std::io::Error)`, but `std::io::Error` in this path represents command spawn/setup failures, not non-zero process exits. Non-zero exits are modeled separately by `ExecutionFailed`.\n\nWhy this matters:\n- Error names can mislead maintainers and users.\n- Diagnostics lack enough context (e.g., which command failed to spawn).\n\nRelevant file:\n- `crates/git-smee-core/src/executor.rs`\n\nImplementation notes:\n- Rename/refactor error variants so names match actual failure mode.\n- Include command text (or a redacted representation) in spawn failure errors.\n- Keep exit-code failures and signal terminations distinct.","acceptance_criteria":"1. Spawn/setup failures are reported via a clearly named error variant (e.g., `CommandSpawnFailed`) with command context.\n2. Non-zero exit codes remain distinct and continue surfacing exit code details.\n3. Add/adjust tests covering spawn failure and non-zero exit paths.\n4. Public error messages become more actionable without exposing sensitive data.","status":"closed","priority":2,"issue_type":"task","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:20:00.350329+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-04T17:56:07.723127+01:00","closed_at":"2026-02-04T17:56:07.723127+01:00","close_reason":"Closed"}
{"id":"git-smee-8db","title":"Add Windows CI job for build/test coverage","description":"Background:\nCurrent CI in `.github/workflows/ci.yml` runs only on `ubuntu-latest`. Platform-specific regressions (especially Windows shell/permissions behavior) can slip through undetected.\n\nWhy this matters:\n- The project claims cross-platform support, but CI does not verify it.\n- Recent code paths rely on OS-specific abstractions (`Platform`, hook templates).\n\nRelevant file:\n- .github/workflows/ci.yml\n\nImplementation notes:\n- Add a Windows job (at least stable toolchain) that runs build + tests.\n- Keep runtime reasonable (can skip coverage on Windows).\n- Consider scoping unstable tests if any are shell-dependent and currently Unix-specific.","acceptance_criteria":"1. CI includes a Windows runner job (`windows-latest`) for at least stable Rust.\n2. The Windows job runs `cargo build --workspace --all-targets` and `cargo test --workspace`.\n3. Existing Linux matrix remains intact.\n4. README/CONTRIBUTING (if applicable) notes that CI validates Windows compatibility.","status":"open","priority":2,"issue_type":"task","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:34:31.112643+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-06T23:38:16.365274+01:00"}
{"id":"git-smee-98b","title":"Refactor executor tests to be deterministic and cross-platform","description":"Background:\nExecutor tests currently rely on shell commands such as `sleep` and `echo`, and on timing assertions with narrow thresholds. This can be flaky and platform-specific (especially Windows).\n\nWhy this matters:\n- Inconsistent CI behavior across OSes.\n- Tests may fail due to host load rather than logic regressions.\n\nRelevant files:\n- `crates/git-smee-core/src/executor.rs`\n- `crates/git-smee-core/src/platform.rs` (if injection points are added)\n\nImplementation notes:\n- Introduce an abstraction for command execution (trait or injectable function) so tests can use a fake runner.\n- Keep production behavior identical while making tests independent of system shell tools and wall-clock timing.","acceptance_criteria":"1. Executor unit tests pass on Unix and Windows without relying on `sleep`/`echo` shell behavior.\n2. Timing-sensitive assertions are removed or relaxed via deterministic fakes.\n3. Test suite still verifies sequential-before-parallel semantics and failure propagation.\n4. No change in public runtime behavior of `execute_hook`.","status":"closed","priority":2,"issue_type":"task","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:19:51.605032+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-04T21:56:06.649471+01:00","closed_at":"2026-02-04T21:56:06.649471+01:00","close_reason":"Closed"}
{"id":"git-smee-9vt","title":"Add hook-script escaping regression tests for special paths","description":"Background:\nHook scripts interpolate absolute executable and config paths into shell templates. The code includes dedicated escaping helpers for Unix and Windows, but current tests mostly assert that plain paths are present. There is no regression coverage for paths containing shell-sensitive characters like single quotes, percent signs, or spaces with quoting edge cases.\n\nWhy this matters:\n- Incorrect escaping can make installed hooks fail at runtime.\n- Path edge cases often appear in CI workspaces and user home directories.\n- Testing gaps can hide cross-platform regressions.\n\nRelevant files:\n- crates/git-smee-core/src/installer.rs\n- crates/git-smee-core/src/scripts/hook_template_unix\n- crates/git-smee-core/src/scripts/hook_template_windows\n- crates/git-smee-cli/tests/cli_integration.rs\n\nImplementation notes:\n- Add focused unit tests for shell_single_quote and cmd_escape helper behavior.\n- Add at least one integration-style assertion that generated hook content includes correctly escaped values for tricky paths.\n- Keep tests deterministic and platform-gated where needed.","acceptance_criteria":"1. Unit tests cover Unix and Windows escaping helpers with representative special-character paths.\n2. Generated hook script content assertions include at least one edge-case path scenario.\n3. Tests pass on Linux and Windows CI without flakiness.\n4. No behavior change for normal paths.","status":"closed","priority":2,"issue_type":"task","owner":"eran@riesenfeld.de","created_at":"2026-02-05T10:38:18.258264+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-06T23:34:33.765876+01:00","closed_at":"2026-02-06T23:34:33.765876+01:00","close_reason":"Completed"}
{"id":"git-smee-f95","title":"Reject unknown hook names in .git-smee.toml","description":"Background:\n`SmeeConfig` currently flattens hook tables into `HashMap\u003cLifeCyclePhase, Vec\u003cHookDefinition\u003e\u003e` and `LifeCyclePhase` includes `Unknown` via `#[serde(other)]`. Unknown hook keys can silently deserialize as `Unknown`, and multiple unknown keys can overwrite each other in the map.\n\nWhy this matters:\n- User typos in hook names are not surfaced clearly.\n- Config data can be lost silently when multiple unknown keys collapse into one map key.\n- Installer may emit a literal `unknown` hook script.\n\nRelevant files:\n- `crates/git-smee-core/src/config.rs`\n- `crates/git-smee-core/src/installer.rs`\n\nImplementation notes:\n- Remove the silent fallback path for unknown lifecycle phases during config parse.\n- Return a precise parse/validation error that includes the unknown hook name.\n- Keep behavior for known lifecycle phases unchanged.","acceptance_criteria":"1. Parsing a config with an unknown hook key (for example `[[pre-commmit]]`) fails with an actionable error that includes the bad key.\n2. Multiple unknown keys do not collapse into a single internal key.\n3. `install_hooks` never generates a hook script for an `unknown` lifecycle phase.\n4. Add regression tests covering unknown hook keys and one positive test confirming valid keys still parse.","status":"closed","priority":1,"issue_type":"bug","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:19:13.22417+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-04T10:09:53.260353+01:00","closed_at":"2026-02-04T10:09:53.260353+01:00","close_reason":"Closed"}
{"id":"git-smee-h4v","title":"Align supported hook list with Git docs","description":"Background:\nThe README claims support for all standard Git lifecycle hooks, but the `LifeCyclePhase` enum omits several server-side hooks (e.g., pre-receive, update, post-receive). This is either a capability gap or a documentation mismatch.\n\nWhy this matters:\n- Users may configure hooks that cannot be parsed, leading to confusing errors.\n- Documentation drift reduces trust in the tool.\n\nRelevant files:\n- crates/git-smee-core/src/config.rs (LifeCyclePhase)\n- README.md (Supported Git Hooks section)\n- crates/git-smee-core/tests/config_integration.rs (parsing coverage)\n\nImplementation notes:\n- Decide on intended scope: add missing hooks to `LifeCyclePhase` (with parsing/display updates) or narrow the README to client-side hooks only.\n- If adding hooks, update tests to confirm parsing and stringification for new entries.\n- Keep backward compatibility for existing hook names.\n\nAcceptance criteria:\n1. README accurately reflects the supported hook set.\n2. If new hooks are added, `LifeCyclePhase` supports them with tests.\n3. Config parsing error messages remain user-friendly.\n","status":"closed","priority":2,"issue_type":"task","owner":"eran@riesenfeld.de","created_at":"2026-02-06T09:07:08.744258+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-06T23:40:15.844792+01:00","closed_at":"2026-02-06T23:40:15.844792+01:00","close_reason":"Completed"}
{"id":"git-smee-rkm","title":"Allow git-smee --help outside Git repositories","description":"Background:\n`main()` calls `repository::ensure_in_repo_root()` before parsing CLI args. That means `--help` and `--version` fail unless the current directory is inside a Git repo.\n\nRepro:\n1. Build binary (`cargo build -p git-smee-cli`)\n2. Run from a non-repo dir: `/path/to/git-smee --help`\n3. Current behavior: exits with `Error: NotInGitRepository` instead of printing help.\n\nWhy this matters:\n- Standard CLI UX expects help/version to work anywhere.\n- It blocks discoverability and makes shell completion workflows awkward.\n\nRelevant file:\n- crates/git-smee-cli/src/main.rs","acceptance_criteria":"1. `git smee --help` and `git smee --version` succeed outside Git repositories.\n2. Repo-root validation only runs for commands that actually require repository context (`install`, `init`, `run`).\n3. Error behavior for repository-dependent commands remains unchanged when run outside a repo.\n4. Add CLI integration tests that cover non-repo help/version success and non-repo command failure paths.","status":"closed","priority":1,"issue_type":"bug","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:34:13.568529+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-04T17:18:42.89464+01:00","closed_at":"2026-02-04T17:18:42.89464+01:00","close_reason":"Closed"}
{"id":"git-smee-rnb","title":"Make CLI errors user-friendly instead of Rust debug variants","description":"Background:\nRunning repository-dependent commands outside a git repo currently prints internal Rust enum variants like Error: NotInGitRepository instead of human-readable error text. Similar raw variant output appears for install/init safety errors and config validation failures.\n\nRepro:\n1. Build binary with cargo build -p git-smee-cli.\n2. Run from a non-repo directory: git-smee install.\n3. Current output includes internal variant names.\n\nWhy this matters:\n- End users see implementation details instead of actionable guidance.\n- Error UX is inconsistent with README messaging and reduces trust in CLI polish.\n\nRelevant files:\n- crates/git-smee-cli/src/main.rs\n- crates/git-smee-core/src/repository.rs\n- crates/git-smee-core/src/installer.rs\n- crates/git-smee-core/src/config.rs\n\nImplementation notes:\n- Ensure top-level error rendering uses Display messages from error types, not Debug variant names.\n- Preserve non-zero exit codes on failure.\n- Add contextual hints for common user mistakes where useful (outside repo, missing config file, unknown hook name).","acceptance_criteria":"1. Running git-smee install outside a repository prints a human-friendly message and exits non-zero.\n2. At least two other failure classes (for example overwrite refusal and config parse/validation failure) surface readable actionable text.\n3. Add CLI integration tests that assert stderr content for these failure paths.\n4. Existing success behavior for help/version/install/init/run in valid repos remains unchanged.","status":"closed","priority":1,"issue_type":"bug","owner":"eran@riesenfeld.de","created_at":"2026-02-05T10:37:45.722308+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-05T18:53:59.85645+01:00","closed_at":"2026-02-05T18:53:59.85645+01:00","close_reason":"Closed"}
{"id":"git-smee-wfs","title":"Add CLI test for hook failure exit code","description":"Background:\nThe CLI integration suite covers many config scenarios but does not assert that hook command failures propagate a non-zero exit code and user-friendly error text.\n\nWhy this matters:\n- Ensures users get a clear failure signal when a hook command fails.\n- Prevents regressions in error handling or exit-code propagation.\n\nRelevant files:\n- crates/git-smee-cli/tests/cli_integration.rs\n- crates/git-smee-core/src/executor.rs\n\nImplementation notes:\n- Add a CLI integration test that writes a config with a failing command (e.g., \"false\").\n- Run `git smee run pre-commit` and assert it fails, with stderr containing \"Hook execution failed with exit code\" and a non-zero status.\n- Keep the test OS-agnostic (avoid bash-specific syntax).\n\nAcceptance criteria:\n1. New integration test fails before the change and passes after.\n2. Test asserts non-zero status and user-friendly error message.\n3. Existing tests remain green.\n","status":"closed","priority":2,"issue_type":"task","owner":"eran@riesenfeld.de","created_at":"2026-02-06T09:06:58.159363+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-06T23:29:11.151663+01:00","closed_at":"2026-02-06T23:29:11.151663+01:00","close_reason":"Completed"}
{"id":"git-smee-wmw","title":"Fix Unix-only platform import that breaks Windows builds","description":"Background:\n`crates/git-smee-core/src/platform.rs` imports `std::os::unix::fs::PermissionsExt` unconditionally at module scope, while the crate advertises Windows support. This API is unavailable on Windows targets and can cause compile failures before runtime branching is reached.\n\nWhy this matters:\n- Cross-platform promise in README can be broken at compile time.\n- This can block release pipelines and contributors on Windows.\n\nRelevant file:\n- crates/git-smee-core/src/platform.rs\n\nImplementation notes:\n- Gate Unix-specific imports and permission logic with `#[cfg(unix)]`.\n- Keep Windows behavior as no-op for `make_executable`, but ensure the whole module compiles on Windows targets.","acceptance_criteria":"1. `git-smee-core` compiles successfully for at least one Windows target (e.g. `x86_64-pc-windows-msvc` or `x86_64-pc-windows-gnu`).\n2. Unix permission handling remains unchanged on Unix builds.\n3. Add/adjust tests so `Platform::make_executable` behavior is validated under cfg-specific paths (or equivalent unit coverage).\n4. No regressions in existing Unix/Linux CI jobs.","status":"closed","priority":1,"issue_type":"bug","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:34:24.53991+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-04T10:09:34.676641+01:00","closed_at":"2026-02-04T10:09:34.676641+01:00","close_reason":"Closed"}
{"id":"git-smee-zhn","title":"Add configurable config path support and robust hook command resolution","description":"Background:\nThe CLI always reads `.git-smee.toml` from repo root and installed hook templates call `git smee run \u003chook\u003e` via shell PATH lookup.\n\nWhy this matters:\n- Teams may want alternate config locations for migration/testing.\n- Hook execution can fail in restricted environments where PATH does not include the git-smee binary.\n\nRelevant files:\n- `crates/git-smee-cli/src/main.rs`\n- `crates/git-smee-core/src/installer.rs`\n- `crates/git-smee-core/src/scripts/hook_template_unix`\n- `crates/git-smee-core/src/scripts/hook_template_windows`\n- `README.md`\n\nImplementation notes:\n- Add `--config \u003cpath\u003e` and optional `GIT_SMEE_CONFIG` fallback.\n- Resolve precedence explicitly (flag \u003e env \u003e default).\n- Improve generated hook scripts so they can reliably invoke git-smee even when PATH is limited (for example via absolute executable path or a validated fallback strategy).","acceptance_criteria":"1. `git smee` commands accept `--config \u003cpath\u003e` and read from that file.\n2. `GIT_SMEE_CONFIG` works when `--config` is not provided.\n3. Precedence is documented and covered by tests.\n4. Installed hook scripts run reliably in a minimal PATH environment.\n5. README includes usage examples for alternate config paths.","status":"closed","priority":2,"issue_type":"feature","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:20:10.096744+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-04T18:39:00.964179+01:00","closed_at":"2026-02-04T18:39:00.964179+01:00","close_reason":"Closed"}
{"id":"git-smee-znv","title":"Support worktrees and core.hooksPath when installing hooks","description":"Background:\n`FileSystemHookInstaller` currently assumes hooks always live under `\u003crepo\u003e/.git/hooks`. That assumption fails for Git worktrees and repositories with `core.hooksPath` configured.\n\nWhy this matters:\n- `git smee install` can write hook files to the wrong location.\n- Users can think hooks are installed while Git executes a different hooks directory.\n\nRelevant files:\n- `crates/git-smee-core/src/installer.rs`\n- `crates/git-smee-core/src/repository.rs`\n- optionally `crates/git-smee-cli/src/main.rs` if CLI wiring needs changes\n\nImplementation notes:\n- Resolve the effective hooks directory through Git metadata (for example `git rev-parse --git-path hooks`) instead of hardcoding `.git/hooks`.\n- Ensure logic works for standard repos, worktrees, and explicit `core.hooksPath`.\n- Preserve clear error messages when the resolved hooks path does not exist or is not writable.","acceptance_criteria":"1. Installing hooks writes to the same hooks path Git actually uses.\n2. Add tests that cover at least:\n   - standard repository\n   - worktree-style `.git` indirection or equivalent fixture\n   - custom hooks path scenario\n3. Error messages include the resolved path when installation cannot proceed.\n4. Existing `install` behavior for normal repos remains unchanged.","status":"closed","priority":1,"issue_type":"bug","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:19:23.239917+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-04T09:32:35.554872+01:00","closed_at":"2026-02-04T09:32:35.554872+01:00","close_reason":"Completed"}
