{"id":"git-smee-4q5","title":"Add explicit config validation with actionable error messages","description":"Background:\nThe config module defines `ValidationError` but currently does not run a dedicated validation pass after parse. Invalid-but-parseable configs can slip through until execution.\n\nWhy this matters:\n- Users get late/runtime failures instead of immediate feedback.\n- Errors do not always point to the exact hook entry causing problems.\n\nRelevant files:\n- `crates/git-smee-core/src/config.rs`\n- `crates/git-smee-cli/src/main.rs` (where config load errors are surfaced)\n\nImplementation notes:\n- Add a `validate()` pass on `SmeeConfig` and invoke it during load.\n- Validate at least:\n  - command string is not empty/whitespace\n  - hook table entries are structurally valid\n  - unexpected fields are rejected (`deny_unknown_fields` where appropriate)\n- Include hook name and entry index in validation errors for faster debugging.","acceptance_criteria":"1. Invalid configs fail during load with precise messages that identify the failing hook and command entry.\n2. Empty/whitespace `command` values are rejected before execution.\n3. Unknown fields in `HookDefinition` are rejected with clear feedback.\n4. Add unit tests for each validation rule and at least one valid config path.","status":"open","priority":2,"issue_type":"task","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:19:44.392176+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-04T09:19:44.392176+01:00"}
{"id":"git-smee-5q6","title":"Make init/install safe for existing files (managed marker + --force)","description":"Background:\n`git smee init` and hook installation currently write files directly, which can overwrite existing user-managed `.git-smee.toml` or hook scripts.\n\nWhy this matters:\n- Risk of clobbering hand-written hook scripts.\n- Risk of destroying an existing config file unexpectedly.\n- Harder adoption in repositories with pre-existing hook workflows.\n\nRelevant files:\n- `crates/git-smee-cli/src/main.rs`\n- `crates/git-smee-core/src/installer.rs`\n- `crates/git-smee-core/src/scripts/hook_template_unix`\n- `crates/git-smee-core/src/scripts/hook_template_windows`\n- `README.md` command docs\n\nImplementation notes:\n- Detect whether an existing hook/config file is already managed by git-smee (using the managed header marker).\n- Default behavior should avoid overwriting unmanaged files.\n- Add `--force` to allow explicit overwrite.","acceptance_criteria":"1. `git smee init` refuses to overwrite an existing `.git-smee.toml` unless `--force` is provided.\n2. `git smee install` overwrites only managed hook files by default; unmanaged hooks are preserved with a clear message/error.\n3. With `--force`, both commands overwrite as requested.\n4. CLI help text and README document the default safety behavior and `--force`.\n5. Tests cover force and non-force paths.","status":"open","priority":2,"issue_type":"feature","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:19:36.621231+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-04T09:19:36.621231+01:00"}
{"id":"git-smee-7ud","title":"Improve executor error modeling for spawn vs exit failures","description":"Background:\n`executor::Error` includes `NonSuccessfulExitStatus(std::io::Error)`, but `std::io::Error` in this path represents command spawn/setup failures, not non-zero process exits. Non-zero exits are modeled separately by `ExecutionFailed`.\n\nWhy this matters:\n- Error names can mislead maintainers and users.\n- Diagnostics lack enough context (e.g., which command failed to spawn).\n\nRelevant file:\n- `crates/git-smee-core/src/executor.rs`\n\nImplementation notes:\n- Rename/refactor error variants so names match actual failure mode.\n- Include command text (or a redacted representation) in spawn failure errors.\n- Keep exit-code failures and signal terminations distinct.","acceptance_criteria":"1. Spawn/setup failures are reported via a clearly named error variant (e.g., `CommandSpawnFailed`) with command context.\n2. Non-zero exit codes remain distinct and continue surfacing exit code details.\n3. Add/adjust tests covering spawn failure and non-zero exit paths.\n4. Public error messages become more actionable without exposing sensitive data.","status":"open","priority":2,"issue_type":"task","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:20:00.350329+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-04T09:20:00.350329+01:00"}
{"id":"git-smee-98b","title":"Refactor executor tests to be deterministic and cross-platform","description":"Background:\nExecutor tests currently rely on shell commands such as `sleep` and `echo`, and on timing assertions with narrow thresholds. This can be flaky and platform-specific (especially Windows).\n\nWhy this matters:\n- Inconsistent CI behavior across OSes.\n- Tests may fail due to host load rather than logic regressions.\n\nRelevant files:\n- `crates/git-smee-core/src/executor.rs`\n- `crates/git-smee-core/src/platform.rs` (if injection points are added)\n\nImplementation notes:\n- Introduce an abstraction for command execution (trait or injectable function) so tests can use a fake runner.\n- Keep production behavior identical while making tests independent of system shell tools and wall-clock timing.","acceptance_criteria":"1. Executor unit tests pass on Unix and Windows without relying on `sleep`/`echo` shell behavior.\n2. Timing-sensitive assertions are removed or relaxed via deterministic fakes.\n3. Test suite still verifies sequential-before-parallel semantics and failure propagation.\n4. No change in public runtime behavior of `execute_hook`.","status":"open","priority":2,"issue_type":"task","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:19:51.605032+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-04T09:19:51.605032+01:00"}
{"id":"git-smee-f95","title":"Reject unknown hook names in .git-smee.toml","description":"Background:\n`SmeeConfig` currently flattens hook tables into `HashMap\u003cLifeCyclePhase, Vec\u003cHookDefinition\u003e\u003e` and `LifeCyclePhase` includes `Unknown` via `#[serde(other)]`. Unknown hook keys can silently deserialize as `Unknown`, and multiple unknown keys can overwrite each other in the map.\n\nWhy this matters:\n- User typos in hook names are not surfaced clearly.\n- Config data can be lost silently when multiple unknown keys collapse into one map key.\n- Installer may emit a literal `unknown` hook script.\n\nRelevant files:\n- `crates/git-smee-core/src/config.rs`\n- `crates/git-smee-core/src/installer.rs`\n\nImplementation notes:\n- Remove the silent fallback path for unknown lifecycle phases during config parse.\n- Return a precise parse/validation error that includes the unknown hook name.\n- Keep behavior for known lifecycle phases unchanged.","acceptance_criteria":"1. Parsing a config with an unknown hook key (for example `[[pre-commmit]]`) fails with an actionable error that includes the bad key.\n2. Multiple unknown keys do not collapse into a single internal key.\n3. `install_hooks` never generates a hook script for an `unknown` lifecycle phase.\n4. Add regression tests covering unknown hook keys and one positive test confirming valid keys still parse.","status":"open","priority":1,"issue_type":"bug","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:19:13.22417+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-04T09:19:13.22417+01:00"}
{"id":"git-smee-zhn","title":"Add configurable config path support and robust hook command resolution","description":"Background:\nThe CLI always reads `.git-smee.toml` from repo root and installed hook templates call `git smee run \u003chook\u003e` via shell PATH lookup.\n\nWhy this matters:\n- Teams may want alternate config locations for migration/testing.\n- Hook execution can fail in restricted environments where PATH does not include the git-smee binary.\n\nRelevant files:\n- `crates/git-smee-cli/src/main.rs`\n- `crates/git-smee-core/src/installer.rs`\n- `crates/git-smee-core/src/scripts/hook_template_unix`\n- `crates/git-smee-core/src/scripts/hook_template_windows`\n- `README.md`\n\nImplementation notes:\n- Add `--config \u003cpath\u003e` and optional `GIT_SMEE_CONFIG` fallback.\n- Resolve precedence explicitly (flag \u003e env \u003e default).\n- Improve generated hook scripts so they can reliably invoke git-smee even when PATH is limited (for example via absolute executable path or a validated fallback strategy).","acceptance_criteria":"1. `git smee` commands accept `--config \u003cpath\u003e` and read from that file.\n2. `GIT_SMEE_CONFIG` works when `--config` is not provided.\n3. Precedence is documented and covered by tests.\n4. Installed hook scripts run reliably in a minimal PATH environment.\n5. README includes usage examples for alternate config paths.","status":"open","priority":2,"issue_type":"feature","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:20:10.096744+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-04T09:20:10.096744+01:00"}
{"id":"git-smee-znv","title":"Support worktrees and core.hooksPath when installing hooks","description":"Background:\n`FileSystemHookInstaller` currently assumes hooks always live under `\u003crepo\u003e/.git/hooks`. That assumption fails for Git worktrees and repositories with `core.hooksPath` configured.\n\nWhy this matters:\n- `git smee install` can write hook files to the wrong location.\n- Users can think hooks are installed while Git executes a different hooks directory.\n\nRelevant files:\n- `crates/git-smee-core/src/installer.rs`\n- `crates/git-smee-core/src/repository.rs`\n- optionally `crates/git-smee-cli/src/main.rs` if CLI wiring needs changes\n\nImplementation notes:\n- Resolve the effective hooks directory through Git metadata (for example `git rev-parse --git-path hooks`) instead of hardcoding `.git/hooks`.\n- Ensure logic works for standard repos, worktrees, and explicit `core.hooksPath`.\n- Preserve clear error messages when the resolved hooks path does not exist or is not writable.","acceptance_criteria":"1. Installing hooks writes to the same hooks path Git actually uses.\n2. Add tests that cover at least:\n   - standard repository\n   - worktree-style `.git` indirection or equivalent fixture\n   - custom hooks path scenario\n3. Error messages include the resolved path when installation cannot proceed.\n4. Existing `install` behavior for normal repos remains unchanged.","status":"closed","priority":1,"issue_type":"bug","owner":"eran@riesenfeld.de","created_at":"2026-02-04T09:19:23.239917+01:00","created_by":"Eran Riesenfeld","updated_at":"2026-02-04T09:32:35.554872+01:00","closed_at":"2026-02-04T09:32:35.554872+01:00","close_reason":"Completed"}
